# Polymarket 跟单机器人

自动监控"聪明钱包"交易并跟单的机器人，支持青龙面板部署。

## 🏗️ 系统架构

### 简化架构图

```
┌──────────────────────────────────────────┐
│        青龙面板 (Qinglong)                │
│  ┌────────────────────────────────┐      │
│  │   Node.js 跟单机器人            │      │
│  │                                 │      │
│  │  监控模块 → 风控 → 下单 → 统计  │      │
│  └────────────┬────────────────────┘      │
│               │ 定时任务                  │
└───────────────┼───────────────────────────┘
                ↓
    ┌──────────────────────┐
    │   Polymarket APIs    │
    │  • 交易数据 API       │
    │  • 订单执行 API       │
    │  • 奖金领取 API       │
    └──────────────────────┘
```

### 详细架构图

[查看完整架构图](https://leo2021zzz.github.io/testgit/PolyMarket/polymarket-bot-architecture.html)

### 核心模块

1. **交易监控** - 监控聪明钱包的最近交易
2. **风控检查** - 余额、金额、持仓等安全检查
3. **订单执行** - 自动跟单下单（支持重试）
4. **持仓管理** - 防重复下单、自动领取奖金
5. **统计日志** - 记录所有交易和盈亏情况

## ⚡ 核心功能

- ✅ 自动监控多个聪明钱包
- ✅ 智能跟单（固定比例或随机金额）
- ✅ 防重复下单
- ✅ 智能卖出（检测市场切换）
- ✅ 自动领取奖金
- ✅ 风险控制（金额限制、余额保护）
- ✅ 详细统计日志
- ✅ 青龙面板定时任务支持

## 🚀 青龙面板部署

### 1. 安装依赖

进入 **依赖管理** → **NodeJs**，添加：

```
@polymarket/clob-client
@polymarket/builder-signing-sdk
@polymarket/builder-relayer-client
ethers@5
axios
moment
viem
```

### 2. 添加脚本

**脚本管理** → **新建文件** → 粘贴 `polymarket.js` 内容

### 3. 配置环境变量

进入 **环境变量**，添加：

```bash
# 必填
SECRETKEY="你的以太坊私钥"
FUNDER_ADDRESS="你的Polymarket地址"
SMART_WALLET="0x123...
0x456..."

# Builder API (从 polymarket.com/settings?tab=builder 获取)
POLY_BUILDER_API_KEY="your_key"
POLY_BUILDER_SECRET="your_secret"
POLY_BUILDER_PASSPHRASE="your_passphrase"

# 跟单设置
FOLLOW_VALUE="0.1"              # 跟单比例（0=随机）
MIN_ORDER_AMOUNT="1"            # 最小订单 $1
MAX_ORDER_AMOUNT="2"            # 最大订单 $2
MIN_FOLLOW_AMOUNT="100"         # 只跟≥$100的交易
```

**多账户？** 添加 `_1`, `_2` 后缀：
```bash
SECRETKEY_1="key1"
FUNDER_ADDRESS_1="addr1"
```

### 4. 创建定时任务

**定时任务** → **新建任务**：

- **名称**：Polymarket跟单
- **命令**：`task polymarket.js`
- **定时**：`*/2 * * * *` (每2分钟)
- **状态**：运行

多账户用：`task polymarket.js _1`

### 5. 启动并查看日志

点击 **运行** → 进入 **日志管理** 查看

## ⚙️ 配置说明

| 参数 | 说明 | 默认 |
|------|------|------|
| `FOLLOW_VALUE` | 跟单比例，0=随机 | 0.1 |
| `MIN_ORDER_AMOUNT` | 最小订单（美元） | 1 |
| `MAX_ORDER_AMOUNT` | 最大订单（美元） | 2 |
| `MIN_FOLLOW_AMOUNT` | 最小跟随金额 | 100 |

**定时规则：**
- `*/2 * * * *` - 每2分钟
- `*/5 * * * *` - 每5分钟
- `0 */1 * * *` - 每小时

## 🔄 工作原理

```
监控钱包 → 过滤检查 → 计算金额 → 执行订单 → 记录统计
```

**过滤条件：**
- 24小时内交易
- 市场未关闭
- 金额≥设定值
- 未重复持仓
- 余额充足

**智能卖出：**
聪明钱包在同市场切换资产时，自动卖出旧仓位跟随买入

## 📊 日志示例

### 启动信息

```
==================================================
🤖 跟单机器人启动（循环模式）
📊 跟踪钱包: 3 个
🎯 跟单比例: 0.1
💰 最小订单金额: $1
💰 最大订单金额: $2
💰 聪明钱包最小金额: $100
💰 最小余额要求: $1（低于此值将不执行买入）
⏱️  循环间隔: 120 秒
==================================================
```

### 跟单记录

```
📊 累计跟单详细统计:
==================================================

1. 钱包: 0xYourAddress
   ✅ 成功跟单: 5 笔
   💰 总金额: $10.50
   详细记录:
      1) 交易时间: 2024-01-20 10:30:15 
         | 跟单时间: 2024-01-20 10:32:00 
         | BUY | $2.10 | Will Trump win? 
         | 跟随: 0xSmartWallet1

   ❌ 失败跟单: 2 笔
   失败详情:
      1) 交易时间: 2024-01-20 09:45:10 
         | 跟单时间: 2024-01-20 09:47:00 
         | BUY | Some Market 
         | 原因: 余额不足($0.50) 
         | 跟随: 0xSmartWallet3
```

### 账户统计

```
=== 获取账户统计信息 ===

💰 可用 USDC: $25.50
📊 持仓总价值: $100.25
📈 持仓数量: 8 个市场
💰 总浮动盈亏: $5.30
💵 总已实现盈亏: $2.15

📈 总资产: $125.75
   📊 资产构成:
      🏦 投资组合: 79.7% ($100.25)
      💰 可用现金: 20.3% ($25.50)

🎯 发现 2 个可领取的市场
  ✅ 成功领取 2 个市场的奖金
```

## ⚠️ 注意事项

**安全：**
- 🔐 保护好私钥
- 💰 只投入可承受的资金
- 📊 设置合理的金额上限

**青龙面板：**
- 确保所有依赖已安装
- 定时建议2-5分钟
- 定期查看日志
- 修改变量后重启任务

## ❓ 常见问题

**Q: 任务失败？**
检查依赖安装、环境变量格式、查看日志错误

**Q: 订单一直失败？**
检查余额、市场流动性、查看日志

**Q: 多账户怎么配？**
变量加 `_1`, `_2` 后缀，任务用 `task polymarket.js _1`

**Q: 在哪看日志？**
日志管理 → 选择任务

## 📄 免责声明

使用本软件的所有风险由使用者自行承担。

---

⭐ 有帮助请 Star！